<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹å­—å­—å¡ç·´ç¿’è»Ÿé«”</title>
    <style>
        /* --- åŸºç¤æ¨£å¼ --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        /* --- æŒ‰éˆ•æ¨£å¼ --- */
        .btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, opacity 0.3s;
        }
        
        /* ç´…è‰²æŒ‰éˆ•ç”¨æ–¼æ¸…é™¤ */
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover:not(:disabled) {
            background-color: #c0392b;
        }

        .btn:hover:not(:disabled) {
            background-color: #27ae60;
        }

        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        /* --- è¼¸å…¥å€æ¨£å¼ --- */
        #add-form {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        #new-char-input {
            flex-grow: 1;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
        }

        /* --- å­—å¡å€å¡Šæ¨£å¼ --- */
        .card-section {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #ecf0f1;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .card-section h2 {
            margin-top: 0;
            color: #34495e;
            border-bottom: 2px solid #bdc3c7;
            padding-bottom: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- å­—å¡æ¨£å¼ (åˆ—è¡¨æ¨¡å¼) --- */
        .char-card {
            display: inline-block;
            margin: 8px;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            position: relative; 
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .familiar {
            background-color: #e8f8f5;
            border: 2px solid #1abc9c;
            color: #1abc9c;
        }

        .unfamiliar {
            background-color: #fbecec;
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }

        .toggle-hint {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #3498db;
            color: white;
            font-size: 12px;
            padding: 3px 6px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .char-card:hover .toggle-hint {
            opacity: 1;
        }
        
        /* åˆªé™¤æŒ‰éˆ•æ¨£å¼ */
        .delete-btn {
            position: absolute;
            bottom: -5px; 
            left: 50%;
            transform: translateX(-50%);
            background: #c0392b;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            opacity: 0; 
            transition: opacity 0.3s;
            cursor: pointer;
            z-index: 10;
        }

        .char-card:hover .delete-btn {
            opacity: 1;
        }


        .empty-message {
            color: #7f8c8d;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        /* --- ç·´ç¿’æ¨¡å¼æ¨£å¼ --- */
        #practice-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #2c3e50;
            color: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        #practice-char {
            font-size: 30vh;
            font-weight: 900;
            margin-bottom: 50px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .practice-controls button {
            margin: 0 15px;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
        }

        #known-button {
            background-color: #1abc9c;
        }

        #skip-button {
            background-color: #e67e22;
        }
        
        /* çµæŸç·´ç¿’æŒ‰éˆ• (å·²ä¿®æ­£ç‚º fixed) */
        #exit-practice-button {
            position: fixed;
            top: 5px;
            right: 5px;
            background-color: #e74c3c;
            padding: 10px 15px;
            font-size: 14px;
            z-index: 1001; 
        }
    </style>
</head>
<body>

    <div class="container" id="main-interface">
        <h1>ğŸ“š åœ‹å­—å­—å¡ç·´ç¿’è»Ÿé«”</h1>

        <div id="add-block">
            <form id="add-form">
                <input type="text" id="new-char-input" placeholder="è¼¸å…¥æ–°çš„åœ‹å­— (ä¾‹å¦‚ï¼šé­‘é­…é­é­)" maxlength="20" required>
                <button type="submit" class="btn" id="add-button">æ·»åŠ </button>
            </form>
        </div>

        <div class="card-section">
            <h2>
                <span style="color: #e74c3c;">âš ï¸ ä¸ç†Ÿæ‚‰çš„å­—</span>
                <button class="btn" id="start-practice-btn">ğŸš€ é–‹å§‹ç·´ç¿’</button>
            </h2>
            <div id="unfamiliar-list">
                <p class="empty-message" id="unfamiliar-empty-message">ç›®å‰æ²’æœ‰ä¸ç†Ÿæ‚‰çš„å­—ï¼</p>
            </div>
        </div>

        <div class="card-section">
            <h2>
                <span style="color: #1abc9c;">âœ… å·²ç†Ÿæ‚‰çš„å­—</span>
                <button class="btn btn-danger" id="clear-familiar-btn" disabled>ğŸ—‘ï¸ ä¸€éµæ¸…é™¤</button>
            </h2>
            <div id="familiar-list">
                <p class="empty-message" id="familiar-empty-message">ç›®å‰æ²’æœ‰å·²ç†Ÿæ‚‰çš„å­—ï¼</p>
            </div>
        </div>
    </div>

    <div id="practice-mode">
        <button class="btn" id="exit-practice-button">âŒ çµæŸç·´ç¿’</button>
        <div id="practice-char"></div>
        <div class="practice-controls">
            <button class="btn" id="known-button">âœ… æˆ‘æœƒå”¸äº† (æ¨™è¨˜ç‚ºå·²ç†Ÿæ‚‰)</button>
            <button class="btn" id="skip-button">â–¶ï¸ è·³é (ä¸‹ä¸€å€‹)</button>
        </div>
    </div>

    <script>
        // --- JavaScript é‚è¼¯ ---

        const STORAGE_KEY = 'chineseFlashcards';
        let cards = [];
        
        let practiceQueue = [];
        let currentCardIndex = 0;

        // DOM å…ƒç´ å¼•ç”¨
        const mainInterface = document.getElementById('main-interface');
        const practiceMode = document.getElementById('practice-mode');
        const practiceCharDisplay = document.getElementById('practice-char');
        const startPracticeBtn = document.getElementById('start-practice-btn');
        const clearFamiliarBtn = document.getElementById('clear-familiar-btn'); // æ–°å¢å¼•ç”¨
        const knownButton = document.getElementById('known-button');
        const skipButton = document.getElementById('skip-button');
        const exitPracticeButton = document.getElementById('exit-practice-button');
        
        const unfamiliarListDiv = document.getElementById('unfamiliar-list');
        const familiarListDiv = document.getElementById('familiar-list');
        const unfamiliarEmptyMsg = document.getElementById('unfamiliar-empty-message');
        const familiarEmptyMsg = document.getElementById('familiar-empty-message');
        const addForm = document.getElementById('add-form');
        const newCharInput = document.getElementById('new-char-input');

        // --- è³‡æ–™è™•ç†èˆ‡å„²å­˜ ---

        function loadCards() {
            const storedData = localStorage.getItem(STORAGE_KEY);
            if (storedData) {
                cards = JSON.parse(storedData);
            }
        }

        function saveCards() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ (åˆªé™¤èˆ‡æ¸…é™¤) ---
        
        /**
         * æ°¸ä¹…åˆªé™¤å–®å€‹å­—è© (ä¸å†è©¢å•)
         * @param {string} character - è¦åˆªé™¤çš„åœ‹å­—
         */
        function deleteCharacter(character) {
            cards = cards.filter(c => c.character !== character);
            saveCards();
            renderCards();
        }

        /**
         * ä¸€éµæ¸…é™¤æ‰€æœ‰å·²ç†Ÿæ‚‰çš„å­—
         */
        function clearFamiliarCards() {
            if (confirm('ç¢ºå®šè¦æ°¸ä¹…æ¸…é™¤æ‰€æœ‰ã€Œå·²ç†Ÿæ‚‰çš„å­—ã€å—ï¼Ÿ')) {
                // éæ¿¾æ‰ isFamiliar ç‚º true çš„å­—
                cards = cards.filter(c => !c.isFamiliar);
                saveCards();
                renderCards();
            }
        }
        
        // --- åˆ—è¡¨æ¸²æŸ“åŠŸèƒ½ ---

        function createCardElement(cardData) {
            const card = document.createElement('div');
            card.dataset.char = cardData.character;
            card.className = `char-card ${cardData.isFamiliar ? 'familiar' : 'unfamiliar'}`;
            card.textContent = cardData.character;

            // æç¤ºåˆ‡æ›
            const hint = document.createElement('span');
            hint.className = 'toggle-hint';
            hint.textContent = cardData.isFamiliar ? 'æ¨™è¨˜ç‚ºä¸ç†Ÿæ‚‰' : 'æ¨™è¨˜ç‚ºå·²ç†Ÿæ‚‰';
            card.appendChild(hint);
            
            // åˆªé™¤æŒ‰éˆ•
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = 'åˆªé™¤';
            
            // é»æ“Šåˆªé™¤æŒ‰éˆ•ï¼Œåœæ­¢äº‹ä»¶å‚³æ’­ (é˜²æ­¢åŒæ™‚è§¸ç™¼å¡ç‰‡ç‹€æ…‹åˆ‡æ›)
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                deleteCharacter(cardData.character);
            });
            card.appendChild(deleteBtn);

            // é»æ“Šå¡ç‰‡äº‹ä»¶ï¼šåˆ‡æ›ç†Ÿæ‚‰/ä¸ç†Ÿæ‚‰ç‹€æ…‹
            card.addEventListener('click', () => toggleFamiliarity(cardData.character, true));
            return card;
        }

        function renderCards() {
            unfamiliarListDiv.innerHTML = '';
            familiarListDiv.innerHTML = '';

            const unfamiliarCards = cards.filter(c => !c.isFamiliar);
            const familiarCards = cards.filter(c => c.isFamiliar);

            // æ¸²æŸ“ä¸ç†Ÿæ‚‰åˆ—è¡¨
            if (unfamiliarCards.length > 0) {
                unfamiliarEmptyMsg.style.display = 'none';
                unfamiliarCards.forEach(card => {
                    unfamiliarListDiv.appendChild(createCardElement(card));
                });
                startPracticeBtn.disabled = false;
            } else {
                unfamiliarEmptyMsg.style.display = 'block';
                startPracticeBtn.disabled = true;
            }

            // æ¸²æŸ“å·²ç†Ÿæ‚‰åˆ—è¡¨
            if (familiarCards.length > 0) {
                familiarEmptyMsg.style.display = 'none';
                familiarCards.forEach(card => {
                    familiarListDiv.appendChild(createCardElement(card));
                });
                clearFamiliarBtn.disabled = false; // æœ‰å­—æ‰èƒ½æ¸…é™¤
            } else {
                familiarEmptyMsg.style.display = 'block';
                clearFamiliarBtn.disabled = true;
            }
        }

        function addCharacter(character) {
            const existing = cards.find(c => c.character === character);
            if (existing) {
                console.log(`ã€Œ${character}ã€å·²å­˜åœ¨ã€‚`);
                return;
            }

            cards.push({
                character: character,
                isFamiliar: false
            });

            saveCards();
            renderCards();
        }

        function toggleFamiliarity(character, shouldRender = true) {
            const card = cards.find(c => c.character === character);
            if (card) {
                card.isFamiliar = !card.isFamiliar;
                saveCards();
                if (shouldRender) {
                    renderCards();
                }
            }
        }

        // --- ç·´ç¿’æ¨¡å¼é‚è¼¯ (èˆ‡ v2.1 ç›¸åŒ) ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startPractice() {
            practiceQueue = cards.filter(c => !c.isFamiliar).map(c => c.character);
            if (practiceQueue.length === 0) {
                alert('æ²’æœ‰ä¸ç†Ÿæ‚‰çš„å­—å¯ä»¥ç·´ç¿’ï¼è«‹å…ˆæ·»åŠ æˆ–æ¨™è¨˜ä¸€äº›å­—ã€‚');
                return;
            }
            
            shuffleArray(practiceQueue);
            currentCardIndex = 0;

            mainInterface.style.display = 'none';
            practiceMode.style.display = 'flex';

            showCurrentCard();
        }

        function showCurrentCard() {
            if (currentCardIndex < practiceQueue.length) {
                practiceCharDisplay.textContent = practiceQueue[currentCardIndex];
                knownButton.textContent = 'âœ… æˆ‘æœƒå”¸äº† (æ¨™è¨˜ç‚ºå·²ç†Ÿæ‚‰)';
                skipButton.textContent = 'â–¶ï¸ è·³é (ä¸‹ä¸€å€‹)';
            } else {
                finishPractice();
            }
        }

        function handleKnown() {
            const currentChar = practiceQueue[currentCardIndex];
            toggleFamiliarity(currentChar, false); 
            
            currentCardIndex++;
            showCurrentCard();
        }

        function handleSkip() {
            currentCardIndex++;
            showCurrentCard();
        }

        function finishPractice() {
            alert(`æœ¬æ¬¡ç·´ç¿’çµæŸï¼æ‚¨å…±ç·´ç¿’äº† ${practiceQueue.length} å€‹å­—ã€‚`);
            
            practiceMode.style.display = 'none';
            mainInterface.style.display = 'block';

            renderCards(); 
        }

        // --- äº‹ä»¶ç›£è½å™¨èˆ‡åˆå§‹åŒ– ---

        addForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const character = newCharInput.value.trim();

            if (character) {
                for (let char of character) {
                    addCharacter(char);
                }
            }
            newCharInput.value = '';
        });

        startPracticeBtn.addEventListener('click', startPractice);
        
        // æ–°å¢ï¼šä¸€éµæ¸…é™¤äº‹ä»¶
        clearFamiliarBtn.addEventListener('click', clearFamiliarCards); 

        knownButton.addEventListener('click', handleKnown);
        skipButton.addEventListener('click', handleSkip);
        exitPracticeButton.addEventListener('click', finishPractice);

        // ç¨‹å¼å•Ÿå‹•ï¼šè®€å–è³‡æ–™ä¸¦æ¸²æŸ“ç•«é¢
        loadCards();
        renderCards();

        // å•Ÿå‹•æ™‚åŠ å…¥ä¸€å€‹ç¯„ä¾‹å­— (å¦‚æœåˆ—è¡¨ç‚ºç©º)
        if (cards.length === 0) {
            addCharacter('é­‘');
            addCharacter('é­…');
            addCharacter('é­');
            addCharacter('é­');
            addCharacter('é¾˜');
            toggleFamiliarity('é­‘', false);
            toggleFamiliarity('é­…', false); // è¨­å®š 'é­…' ç‚ºç†Ÿæ‚‰ï¼Œä»¥æ¸¬è©¦æ¸…é™¤åŠŸèƒ½
            renderCards();
        }
    </script>
</body>
</html>